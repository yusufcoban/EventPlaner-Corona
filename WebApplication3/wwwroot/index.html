<!DOCTYPE html>
<html>
<head>
    <title>Eventplaner</title>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/marked@0.3.6"></script>
    <script src="https://unpkg.com/lodash@4.16.0"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/ajax.js" asp-append-version="true"></script>
</head>
<body>
    <div id="editor">
        <template v-if="!barCodeGiven">
            <div class="form-group mb-2">
                <label for="" class="sr-only">
                    Vorname
                </label>
                <input type="text" readonly class="form-control-plaintext" :value="currentUser.firstname">
            </div>
            <div class="form-group mb-2">
                <label for="" class="sr-only">
                    Nachname
                </label>
                <input type="text" readonly class="form-control-plaintext" :value="currentUser.lastname">
            </div>
            <form class="form-inline">
                <div class="form-group mb-2">
                    <label for="" class="sr-only">
                        Email
                    </label>
                    <input type="text" readonly class="form-control-plaintext" :value="currentUser.email">
                </div>
            </form>
        </template>
        <template v-else>
            Hallo {{currentUser.firstname}} {{currentUser.lastname}}
        </template>
    </div>
    <script>
        new Vue({
            el: "#editor",
            data: {
                currentUser: {},
                uriBarcode: '/User/byBarcode?barcode=',
                barCodeGiven: false
            },
            computed: {
            },
            mounted()
            {
                // fetch data
                this.preLoadUser();
            },
            methods: {
                preLoadUser: function ()
                {
                    var that = this;
                    var barcode = ajaxUtilities.getUrlParameter('barcode');
                    if (barcode != null)
                    {
                        that.barCodeGiven = true;
                        var promise = ajaxUtilities.GetJson(that.uriBarcode + barcode);
                        $.when(promise).done(function (result)
                        {
                            that.currentUser = result;
                        }).fail(function ()
                        {
                            debugger;
                        });
                    }
                }
            }
        });
    </script>
</body>
</html>
